<div class="row">
  <div class="col-sm-12 col-lg-12">
    <div class="iq-card">
      <div class="iq-card-body">
        <div class="row">
          <div class="col-md-12">
            <div class="iq-card">
              <div class="iq-card-header d-flex justify-content-between">
                <div class="iq-header-title">
                  <h4 class="card-title">Cumulative Report</h4>
                </div>
              </div>
              <div class="iq-card-body">
                <form id="form-wizard3" class="text-center">
                  <div class="form-card text-left">
                    <div class="row">
                      <div class="col-md-12">
                        <!-- <table id="mytable" class="table table-striped table-bordered table-sm row-border hover">
                          <thead>
                            <tr>
                              <th>Country</th>
                              <th>Population</th>
                              <th>Date</th>
                              <th>Age</th>
                              <th>REMARKS</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>India</td>
                              <td>1363480000</td>
                              <td>March 24 2014</td>
                              <td>19.1</td>
                              <td>â‚¹</td>
                            </tr>
                            <tr>
                              <td>India</td>
                              <td>1241900000</td>
                              <td>March 24 2014</td>
                              <td>17.4</td>
                              <td>Remarks 2</td>
                            </tr>
                            <tr>
                              <td>United States</td>
                              <td>317746000</td>
                              <td>March 24 2014</td>
                              <td>4.44</td>
                              <td>Remarks 3</td>
                            </tr>
                            <tr>
                              <td>Indonesia</td>
                              <td>249866000</td>
                              <td>July 1 2013</td>
                              <td>3.49</td>
                              <td>Remarks 4</td>
                            </tr>
                            <tr>
                              <td>Brazil</td>
                              <td>201032714</td>
                              <td>July 1 2013</td>
                              <td>2.81</td>
                              <td>Remarks 5</td>
                            </tr>
                          </tbody>
                        </table> -->

                        <div class="table-responsive">
                          <div class="row justify-content-between">
                            <div class="col-md-12">
                              <button class="mr-1 mb-2" (click)="exportAs('csv')">export as csv</button>
                              <button class="mr-1 mb-2" (click)="exportAs('xlsx')">export as Ms-Excel</button>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-2">
                              <!-- <app-datepicker-range 
                              (dateSelection)="setFilter('date', $event)"></app-datepicker-range> -->
                              <div class="form-group">
                                <label for="exampleInputSite">Select Site</label>
                                <select class="form-control" id="exampleInputSite" name="site_id" (change)="changeSiteSelection($event)"
                                  [value]="selectedSiteId">
                                  <option [attr.value]="col._id" *ngFor="let col of sitesArr">{{col.name}}</option>
                                </select>
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="exampleInputdateFrom">From Date</label>
                                <input type="date" class="form-control" id="exampleInputdateFrom" (change)="selectDateFrom($event)">
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="exampleInputdateTo">To Date</label>
                                <input type="date" class="form-control" id="exampleInputdateTo" (change)="selectDateTo($event)">
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="exampleInputtimeFrom">From Time</label>
                                <input type="time" class="form-control" id="exampleInputtimeFrom" (change)="selectTimeFrom($event)">
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group">
                                <label for="exampleInputtimeTo">To Time</label>
                                <input type="time" class="form-control" id="exampleInputtimeTo" (change)="selectTimeTo($event)">
                              </div>
                            </div>
                            <div class="col-md-2">
                              <div class="form-group" style="margin-top: 35px;">
                                <label>&nbsp;</label>
                                <button type="button" class="btn btn-primary" value="Submit" (click)="fetchCumulativeData(selectedSiteId)">Apply Search</button>
                              </div>
                            </div>
                          </div>
                          <div class="row justify-content-between">
                            <div class="col-md-12">
                              <table id="mytable" class="table table-striped table-bordered mt-4" role="grid"
                                aria-describedby="user-list-page-info">
                                <thead *ngIf="dataArr && dataArr.length > 0">
                                  <tr>
                                    <th colspan="100" class="text-center">STATION NAME:
                                      {{selectedSiteData?.name}}</th>
                                  </tr>
                                  <tr>
                                    <th colspan="100" class="text-center">DETAILED REPORT FOR THE PERIOD OF: {{dateFromVal}} To {{dateToVal}}
                                      <span *ngIf="timeFromVal !== ''">{{timeFromVal}} To {{timeToVal}}</span>
                                    </th>
                                  </tr>
                                  <tr>
                                    <th width="10%">DATE-TIME</th>
                                    <th class="text-center"
                                      *ngFor='let pmpTh of dataArr[0].pumpData; let pumpInd = index;'
                                      [attr.colspan]="getPumpDataLength(dataArr[0].pumpData[pumpInd])">
                                      PUMP {{ pumpInd + 1}}
                                    </th>
                                    <th class="text-center"
                                      *ngFor='let meterTh of dataArr[0].meterData; let meterInd = index;'
                                      [attr.colspan]="getMeterDataLength(dataArr[0].meterData[meterInd])">
                                      DATA METER {{ meterInd + 1}}
                                    </th>
                                    <th width="5%">FLOW RATE</th>
                                    <th width="5%">LEVEL RATE</th>
                                  </tr>
                                  <tr>
                                    <th width="10%"></th>
                                    <ng-container *ngFor='let innerData of dataArr[0].pumpData'>
                                      <ng-container *ngFor='let data of innerData'>
                                          <th *ngFor='let subheader of data | keyvalue'>
                                            {{subheader.key | uppercase}}
                                          </th>
                                        </ng-container>
                                    </ng-container>
                                    <ng-container *ngFor='let mtkey of dataArr[0].meterData'>
                                      <th *ngFor='let subheaderMt of mtkey | keyvalue'>
                                        {{subheaderMt.key | uppercase}}
                                      </th>
                                    </ng-container>
                                    <th></th>
                                    <th></th>
                                  </tr>
                                </thead>
                                <tbody *ngIf="dataArr && dataArr.length > 0">
                                  <tr
                                    *ngFor="let dataEle of dataArr; let dataEleIndex = index">
                                    <td>{{ dataEle.date + ' '+ dataEle.time }}</td>

                                    <!-- <ng-container *ngFor='let innerData of dataArr[0].pumpData'>
                                      <ng-container *ngFor='let data of innerData'>
                                          <th *ngFor='let subheader of data | keyvalue'>
                                            {{subheader.key | uppercase}}
                                          </th>
                                        </ng-container>
                                    </ng-container> -->
                                    <ng-container *ngFor='let pEle of dataEle.pumpData; let pumpInd = index;'>
                                     <ng-container *ngFor='let data of pEle; let pumpIndInner = index;'>
                                         <th *ngFor='let subheaderPmp of data | keyvalue; let pumpKeyValueIndex = index;'>
                                            <span *ngIf="pumpIndInner == 0 && !subheaderPmp.value">OFF</span>
                                            <span *ngIf="pumpIndInner == 1 && !subheaderPmp.value">MANUAL</span>
                                            <span *ngIf="pumpIndInner == 2 && !subheaderPmp.value">CLOSE</span>
                                            <span *ngIf="pumpIndInner == 3 && !subheaderPmp.value">NORMAL</span>
                                            <span *ngIf="subheaderPmp.value">{{subheaderPmp.value}}</span>
                                          </th>
                                        </ng-container>
                                      
                                    </ng-container>
                                    <ng-container *ngIf='dataEle.pumpData.length == 0 && dataArr[dataEleIndex-1] && dataArr[dataEleIndex-1].pumpData.length == 0'>
                                      <ng-container *ngFor='let pmpTh of dataArr[0].pumpData;'>
                                        <th *ngFor='let subheader of pmpTh'>
                                          -
                                        </th>
                                      </ng-container>
                                    </ng-container>
                                    <ng-container *ngIf='dataEle.pumpData.length == 0 && dataArr[dataEleIndex-1] && dataArr[dataEleIndex-1].pumpData.length > 0'>
                                      <ng-container *ngFor='let pEle of dataArr[dataEleIndex-1].pumpData; let pumpInd = index;'>
                                        <ng-container *ngFor='let data of pEle; let pumpIndInner = index;'>
                                            <th *ngFor='let subheaderPmp of data | keyvalue; let pumpKeyValueIndex = index;'>
                                              <span *ngIf="pumpIndInner == 0 && !subheaderPmp.value">OFF</span>
                                              <span *ngIf="pumpIndInner == 1 && !subheaderPmp.value">MANUAL</span>
                                              <span *ngIf="pumpIndInner == 2 && !subheaderPmp.value">CLOSE</span>
                                              <span *ngIf="pumpIndInner == 3 && !subheaderPmp.value">NORMAL</span>
                                              <span *ngIf="subheaderPmp.value">{{subheaderPmp.value}}</span>
                                            </th>
                                          </ng-container>
                                      </ng-container>
                                    </ng-container>
                                    
                                    <ng-container *ngFor='let mEle of dataEle.meterData;let mtInd = index;'>
                                      <th *ngFor='let subheaderMt of mEle | keyvalue'>
                                        <ng-container *ngIf='subheaderMt.value == "-" && dataArr[dataEleIndex-1] && dataArr[dataEleIndex-1].meterData.length > 0'>
                                          <span *ngFor='let subheaderMt of dataArr[dataEleIndex-1].meterData[mtInd] | keyvalue'>
                                              {{subheaderMt.value}}
                                          </span>
                                        </ng-container>
                                        <span *ngIf='subheaderMt.value != "-"'>{{subheaderMt.value}}</span>
                                      </th>
                                    </ng-container>
                                    
                                    <!-- <th class="text-center"
                                      *ngFor='let in of counter(dataArr[0].meterData.length - dataEle.meterData.length)'
                                      >
                                      -
                                    </th> -->
                                    <!-- <ng-container *ngIf='dataEle.meterData.length == 0'>
                                      <th class="text-center"
                                      *ngFor='let meterTh of dataArr[0].meterData'
                                      >
                                      -
                                    </th>
                                    </ng-container> -->
                                    <ng-container *ngFor='let fEle of dataEle.flowData'>
                                      <th *ngFor='let subheaderFlow of fEle | keyvalue'>
                                        {{subheaderFlow.value}}
                                      </th>
                                    </ng-container>
                                    <ng-container *ngFor='let lEle of dataEle.levelData'>
                                      <th *ngFor='let subheaderLevel of lEle | keyvalue'>
                                        {{subheaderLevel.value}}
                                      </th>
                                    </ng-container>
                                    <td class="text-center" *ngIf="dataEle.flowData.length == 0">
                                      - </td>
                                    <td class="text-center" *ngIf="dataEle.levelData.length == 0">
                                      - </td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>
                          <!-- <div class="row justify-content-between mt-3 mb-3">
                            <div class="col-md-12">
                              <ngb-pagination [collectionSize]="dataArr.length" [(page)]="page" [maxSize]="5"
                                [rotate]="true" [ellipses]="false" [boundaryLinks]="true"></ngb-pagination>
                            </div>
                          </div> -->
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>